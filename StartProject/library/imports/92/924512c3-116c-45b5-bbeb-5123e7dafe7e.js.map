{"version":3,"sources":["assets\\scripts\\Player.js"],"names":["cc","Class","Component","properties","jumpHeight","jumpDuration","jumpTriggle","jumpAudio","type","AudioClip","maxMoveSpeed","accel","maxBackLeftWall","maxBackRightWall","onLoad","accLeft","accRight","xSpeed","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","KEY_UP","onKeyUp","e","keyCode","macro","KEY","left","right","alt","onJumpClick","setXSpeedInit","setJumpAction","callback","callFunc","playJumpSound","jumpUp","moveBy","v2","easing","easeCubicActionOut","jumpDown","easeCubicActionIn","afterAction","sequence","audioEngine","playEffect","jumpAction","node","runAction","update","dt","Math","abs","temp","x","calcLeftRight","translate","onDestroy","off"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    // 角色的各种属性\r\n    properties: {\r\n        // 跳跃高度\r\n        jumpHeight:0,\r\n        // 跳跃持续时间\r\n        jumpDuration:0,\r\n        jumpTriggle:false,\r\n\r\n        jumpAudio:{\r\n            default:null,\r\n            type:cc.AudioClip\r\n        },\r\n\r\n        // 最大移动速度\r\n        maxMoveSpeed:0,\r\n        // 加速度\r\n        accel:0,\r\n\r\n        // 左右的墙\r\n        maxBackLeftWall:-500,\r\n        maxBackRightWall:500,\r\n    },\r\n\r\n    onLoad () {\r\n        // 1、角色默认动作 - 上下横跳\r\n        // this.jumpAction = this.setJumpAction();\r\n        // this.node.runAction(this.jumpAction);\r\n\r\n        // 2、加速度方向的开关\r\n        this.accLeft = false;\r\n        this.accRight = false;\r\n\r\n        // 跳跃的开关\r\n        this.jumpTriggle = false,\r\n\r\n        // 3、当前水平方向的速度\r\n        this.xSpeed = 0;\r\n\r\n        // 4、挂载键盘事件\r\n        cc.systemEvent.on(\r\n            cc.SystemEvent.EventType.KEY_DOWN,\r\n            this.onKeyDown,\r\n            this\r\n        );\r\n        cc.systemEvent.on(\r\n            cc.SystemEvent.EventType.KEY_UP,\r\n            this.onKeyUp,\r\n            this\r\n        )\r\n    },\r\n\r\n    // 键盘按下\r\n    onKeyDown(e){\r\n        switch(e.keyCode){\r\n            case cc.macro.KEY.left:\r\n                this.accLeft = true;\r\n                break;\r\n            case cc.macro.KEY.right:\r\n                this.accRight = true;\r\n                break;\r\n            case cc.macro.KEY.alt:\r\n                if(this.jumpTriggle == false){\r\n                    this.jumpTriggle = true;\r\n                    this.onJumpClick();\r\n                }\r\n                break;\r\n        }\r\n    },\r\n    // 键盘弹起\r\n    onKeyUp(e){\r\n        switch(e.keyCode){\r\n            case cc.macro.KEY.left:\r\n                this.accLeft = false;\r\n                this.setXSpeedInit();\r\n                break;\r\n            case cc.macro.KEY.right:\r\n                this.accRight = false;\r\n                this.setXSpeedInit();\r\n                break;\r\n            case cc.macro.KEY.alt:\r\n                \r\n                break;\r\n        }\r\n    },\r\n\r\n    // 设置跳跃动作\r\n    setJumpAction:function (){\r\n        /**\r\n         * 1、cc.moveBy，在指定的时间，移动指定的距离\r\n         *      参数一，动作完成的时间\r\n         *      参数二，v2是Vec2（表示 2D 向量和坐标），传入x+y，返回一个向量对象\r\n         *      返回值，是ActionInterval对象，是一个时间间隔动作的类，\r\n         *          用来表示这种动作在某一个时间间隔内完成\r\n         * \r\n         * moveBy设计了多态，\r\n         *      两个参数时：参数二是向量对象\r\n         *      三个参数时，参数二是x坐标，参数三是y坐标\r\n         * \r\n         *      注意：这里的x和y，是以角色动作的当前位置而言的。是一个相对位移。\r\n         * \r\n         * 所以jumpUp是构造了一个向上跳跃的动作，jumpDown是下落的动作\r\n         * \r\n         * 2、easing(cc.easeCubicActionOut())\r\n         *      easing是ActionInterval下的方法，可以让动作的执行呈现一条曲线，而不是直线。\r\n         *      动作曲线总共有24种。\r\n         *      From：https://docs.cocos.com/creator/api/zh/modules/cc.html#easecubicactionout\r\n         * \r\n         */\r\n        // 1、播放音乐\r\n        let callback = cc.callFunc(this.playJumpSound,this);\r\n\r\n        // 2、跳起\r\n        let jumpUp = cc\r\n            .moveBy(this.jumpDuration, cc.v2(0,this.jumpHeight))\r\n            .easing(cc.easeCubicActionOut());\r\n        // 3、下落\r\n        let jumpDown = cc\r\n            .moveBy(this.jumpDuration, cc.v2(0,-this.jumpHeight))\r\n            .easing(cc.easeCubicActionIn());\r\n        // 4、将跳跃锁定打开\r\n        let afterAction = cc.callFunc(()=>{\r\n            this.jumpTriggle = false;\r\n        })\r\n        \r\n        /**\r\n         * 1、sequence，动作序列，里面的是一连串的动作\r\n         * 2、repeatForever，动作一直执行\r\n         *      可以传入一个回调函数，回调函数会在两个动作交替的时候执行\r\n         */\r\n        return cc.sequence([callback,jumpUp,jumpDown,afterAction])\r\n    },\r\n    playJumpSound(){\r\n        cc.audioEngine.playEffect(this.jumpAudio,false);\r\n    },\r\n\r\n    // 按下跳跃键\r\n    onJumpClick(){\r\n        this.jumpAction = this.setJumpAction();\r\n        this.node.runAction(this.jumpAction);\r\n    },\r\n\r\n    \r\n\r\n    \r\n    // 横向speed归零\r\n    setXSpeedInit(){\r\n        this.xSpeed = 0;\r\n    },\r\n\r\n    // 视图渲染的每一帧，将会执行一次update\r\n    update (dt) {\r\n        // 1、根据两个开关，来计算当前的x方向的加速度\r\n        if(this.accLeft){\r\n            this.xSpeed -= this.accel * dt;\r\n        }else if(this.accRight){\r\n            this.xSpeed += this.accel * dt;\r\n        }\r\n\r\n        // 2、判断加速度是否超出最大加速度，超出则限制\r\n        if(Math.abs(this.xSpeed) > this.maxMoveSpeed){\r\n            // 求正负号\r\n            let temp = this.xSpeed/Math.abs(this.xSpeed);\r\n            // 限制xSpeed为最大值\r\n            this.xSpeed = this.maxMoveSpeed * temp;\r\n        }\r\n\r\n        // 3、设置节点位移\r\n        this.node.x = this.calcLeftRight(this.node.x , this.xSpeed * dt);\r\n    },\r\n    // 检测左右坐标，来限制最小和最大的左右位移\r\n    calcLeftRight(x,translate){\r\n        let temp = x + translate;\r\n        let {\r\n            maxBackLeftWall,\r\n            maxBackRightWall\r\n        } = this;\r\n        if(temp < 0 && Math.abs(temp) > Math.abs(maxBackLeftWall) ){\r\n            this.setXSpeedInit();\r\n            return maxBackLeftWall\r\n        }\r\n        if(temp > 0 && Math.abs(temp) > Math.abs(maxBackRightWall) ){\r\n            this.setXSpeedInit();\r\n            return maxBackRightWall\r\n        }\r\n        return temp;\r\n    },\r\n\r\n\r\n    onDestroy(){\r\n        // 组件销毁时，将绑定的键盘事件解绑\r\n        cc.systemEvent.off(\r\n            cc.SystemEvent.EventType.KEY_DOWN,\r\n            this.onKeyDown,\r\n            this\r\n        );\r\n        cc.systemEvent.off(\r\n            cc.SystemEvent.EventType.KEY_UP,\r\n            this.onKeyUp,\r\n            this\r\n        )\r\n    },\r\n\r\n    // update (dt) {},\r\n});\r\n"]}