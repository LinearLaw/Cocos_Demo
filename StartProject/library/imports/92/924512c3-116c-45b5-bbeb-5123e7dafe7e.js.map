{"version":3,"sources":["assets\\scripts\\Player.js"],"names":["cc","Class","Component","properties","jumpHeight","jumpDuration","maxMoveSpeed","accel","maxBackLeftWall","maxBackRightWall","setJumpAction","jumpUp","moveBy","v2","easing","easeCubicActionOut","jumpDown","easeCubicActionIn","repeatForever","sequence","onKeyDown","e","keyCode","macro","KEY","left","accLeft","right","accRight","onKeyUp","onLoad","jumpAction","node","runAction","xSpeed","systemEvent","on","SystemEvent","EventType","KEY_DOWN","KEY_UP","update","dt","Math","abs","temp","x","calcLeftRight","translate","onDestroy","off"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    // 角色的各种属性\r\n    properties: {\r\n        // 跳跃高度\r\n        jumpHeight:0,\r\n        // 跳跃持续时间\r\n        jumpDuration:0,\r\n        // 最大移动速度\r\n        maxMoveSpeed:0,\r\n        // 加速度\r\n        accel:0,\r\n\r\n        // 左右的墙\r\n        maxBackLeftWall:-500,\r\n        maxBackRightWall:500,\r\n    },\r\n\r\n    // 设置跳跃动作\r\n    setJumpAction:function (){\r\n        /**\r\n         * 1、cc.moveBy，在指定的时间，移动指定的距离\r\n         *      参数一，动作完成的时间\r\n         *      参数二，v2是Vec2（表示 2D 向量和坐标），传入x+y，返回一个向量对象\r\n         *      返回值，是ActionInterval对象，是一个时间间隔动作的类，\r\n         *          用来表示这种动作在某一个时间间隔内完成\r\n         * \r\n         * moveBy设计了多态，\r\n         *      两个参数时：参数二是向量对象\r\n         *      三个参数时，参数二是x坐标，参数三是y坐标\r\n         * \r\n         *      注意：这里的x和y，是以角色动作的当前位置而言的。是一个相对位移。\r\n         * \r\n         * 所以jumpUp是构造了一个向上跳跃的动作，jumpDown是下落的动作\r\n         * \r\n         * 2、easing(cc.easeCubicActionOut())\r\n         *      easing是ActionInterval下的方法，可以让动作的执行呈现一条曲线，而不是直线。\r\n         *      动作曲线总共有24种。\r\n         *      From：https://docs.cocos.com/creator/api/zh/modules/cc.html#easecubicactionout\r\n         * \r\n         */\r\n        let jumpUp = cc\r\n            .moveBy(this.jumpDuration, cc.v2(0,this.jumpHeight))\r\n            .easing(cc.easeCubicActionOut());\r\n        let jumpDown = cc\r\n            .moveBy(this.jumpDuration, cc.v2(0,-this.jumpHeight))\r\n            .easing(cc.easeCubicActionIn());\r\n\r\n        /**\r\n         * 1、sequence，两个动作交替进行\r\n         * 2、repeatForever，动作一直执行\r\n         */\r\n        return cc.repeatForever(cc.sequence(jumpUp,jumpDown))\r\n    },\r\n\r\n    onKeyDown(e){\r\n        switch(e.keyCode){\r\n            case cc.macro.KEY.left:\r\n                this.accLeft = true;\r\n                break;\r\n            case cc.macro.KEY.right:\r\n                this.accRight = true;\r\n                break;\r\n        }\r\n    },\r\n    onKeyUp(e){\r\n        switch(e.keyCode){\r\n            case cc.macro.KEY.left:\r\n                this.accLeft = false;\r\n                break;\r\n            case cc.macro.KEY.right:\r\n                this.accRight = false;\r\n                break;\r\n        }\r\n    },\r\n\r\n    onLoad () {\r\n        // 1、角色默认动作 - 上下横跳\r\n        this.jumpAction = this.setJumpAction();\r\n        this.node.runAction(this.jumpAction);\r\n\r\n        // 2、加速度方向的开关\r\n        this.accLeft = false;\r\n        this.accRight = false;\r\n\r\n        // 3、当前水平方向的速度\r\n        this.xSpeed = 0;\r\n\r\n        // 4、挂载键盘事件\r\n        cc.systemEvent.on(\r\n            cc.SystemEvent.EventType.KEY_DOWN,\r\n            this.onKeyDown,\r\n            this\r\n        );\r\n        cc.systemEvent.on(\r\n            cc.SystemEvent.EventType.KEY_UP,\r\n            this.onKeyUp,\r\n            this\r\n        )\r\n    },\r\n\r\n    // 视图渲染的每一帧，将会执行一次update\r\n    update (dt) {\r\n        // 1、根据两个开关，来计算当前的x方向的加速度\r\n        if(this.accLeft){\r\n            this.xSpeed -= this.accel * dt;\r\n        }else if(this.accRight){\r\n            this.xSpeed += this.accel * dt;\r\n        }\r\n\r\n        // 2、判断加速度是否超出最大加速度，超出则限制\r\n        if(Math.abs(this.xSpeed) > this.maxMoveSpeed){\r\n            // 求正负号\r\n            let temp = this.xSpeed/Math.abs(this.xSpeed);\r\n            // 限制xSpeed为最大值\r\n            this.xSpeed = this.maxMoveSpeed * temp;\r\n        }\r\n\r\n        // 3、设置节点位移\r\n        this.node.x = this.calcLeftRight(this.node.x , this.xSpeed * dt);\r\n    },\r\n    // 检测左右坐标，来限制最小和最大的左右位移\r\n    calcLeftRight(x,translate){\r\n        let temp = x + translate;\r\n        let {\r\n            maxBackLeftWall,\r\n            maxBackRightWall\r\n        } = this;\r\n        if(temp < 0 && Math.abs(temp) > Math.abs(maxBackLeftWall) ){\r\n            this.xSpeed = 0;\r\n            return maxBackLeftWall\r\n        }\r\n        if(temp > 0 && Math.abs(temp) > Math.abs(maxBackRightWall) ){\r\n            this.xSpeed = 0;\r\n            return maxBackRightWall\r\n        }\r\n        return temp;\r\n    },\r\n\r\n\r\n    onDestroy(){\r\n        // 组件销毁时，将绑定的键盘事件解绑\r\n        cc.systemEvent.off(\r\n            cc.SystemEvent.EventType.KEY_DOWN,\r\n            this.onKeyDown,\r\n            this\r\n        );\r\n        cc.systemEvent.off(\r\n            cc.SystemEvent.EventType.KEY_UP,\r\n            this.onKeyUp,\r\n            this\r\n        )\r\n    },\r\n\r\n    // update (dt) {},\r\n});\r\n"]}